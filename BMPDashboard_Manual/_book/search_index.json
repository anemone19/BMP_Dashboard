[["the-data.html", "3 The Data 3.1 Setting up OneDrive: 3.2 Structure of the Biodiversity KPI Mapping Master 3.3 Getting the data 3.4 Data cleaning and preparation 3.5 Pulling photos and documents from OneDrive 3.6 Things to think about", " 3 The Data 3.1 Setting up OneDrive: The following instructions are for Mac users. If you are using windows, you should have OneDrive already installed on your computer. Download OneDrive: Go to the Mac App Store on your laptop. Search for “OneDrive.” Click on “Get” or “Install” to download the OneDrive app. Install OneDrive: Once downloaded, open your Applications folder and locate the OneDrive app. Drag the OneDrive app to your Dock for easier access (optional). Sign In: Open the OneDrive app. Sign in with your university account. Follow the on-screen prompts to set up OneDrive. Choose Folders to Sync: Once signed in, you’ll have the option to choose which folders from your OneDrive cloud storage you want to sync with your Mac. Select the folders you want or choose to sync everything. Set OneDrive Preferences: Click on the OneDrive icon in the Mac menu bar at the top of your screen. Click on the three dots (More) and select “Preferences.” Here, you can adjust settings like: Starting OneDrive automatically when you sign in to your Mac. Choosing how files are downloaded or uploaded (e.g., over metered networks). Setting up file on-demand (allows you to see all your files without having them downloaded). Accessing Your Files: A OneDrive folder will now be present in your Mac’s Finder. This folder will sync with your online OneDrive storage. Any files or folders you add to this folder will be automatically uploaded to the cloud, and any changes you make to files in this folder will be reflected in the cloud version. Read that again! It important that you know that if you change or delete any files in the OneDrive folder on your laptop it will affect the database online. To Unlink or Sign Out: If you ever wish to unlink your account or sign out, click on the OneDrive icon in the Mac menu bar. Click on the three dots (More) and select “Preferences.” Go to the “Account” tab and select “Unlink this Mac.” 3.1.1 Windows: 3.2 Structure of the Biodiversity KPI Mapping Master 3.3 Getting the data First, navigate to the R script called “packages” to check whether you have all the required packages, if you don’t the script will also install and load them for you. Done! Now navigate to the script “RemoteDataPull_Prepare”, it contains all the code for pulling and cleaning the biodiversity data collected by the students. Each student will have their own folder within this folder. Within each of the student folders, there are various geopackages, one for each taxa they have surveyed. The naming of the geopackages are their initials or names followed by the particular taxa, e.g. Ericabutterflies.gpkg. The most important first step here is to modify the object “path_to_master” with the filepath to where ever you have the OneDrive folder on your device and specifically to the main survey folder “Biodiversity Survey Master”. If you are using a Mac, navigate to the folder in Finder and then in the bottom panel (see below), right click the folder name and select “Copy”folder name” as Pathname”. Let’s break down the code: Setting the Path to the Master Directory: path_to_master &lt;- &quot;/Users/anecloete/Library/CloudStorage/OneDrive-UniversityofStAndrews/Biodiversity KPI mapping Master/Biodiversity Survey Master&quot; This line sets a variable called path_to_master to the path of the main directory where the geopackage files are located. Paste the pathname you copied here. Obtaining All Geopackage Files: all_gpkgs &lt;- list.files( path = paste(path_to_master), recursive = TRUE, pattern = &quot;\\\\.gpkg$&quot;, full.names = TRUE ) This code lists all files with the “.gpkg” extension in the specified directory and its subdirectories. - The path argument specifies where to look. - recursive set to TRUE means it will look in subdirectories as well. - pattern filters for files ending with “.gpkg”. - full.names set to TRUE ensures the full path of each file is returned, not just its name. Filtering Geopackages with ‘Habitat_Polygon’ in Their Name: survey_polygons &lt;- all_gpkgs[grepl(&quot;Habitat_Polygon&quot;, all_gpkgs)] This filters the all_gpkgs vector for filenames that contain the substring “Habitat_Polygon” and assigns the subset to survey_polygons. Excluding Geopackages Based on Certain Keywords: pattern &lt;- &quot;Polygon|DESKTOP|PC|LAPTOP|Wills&quot; all_gpkgs &lt;- all_gpkgs[!grepl(pattern, all_gpkgs)] Here, a pattern is defined to exclude geopackages with certain keywords in their names. The grepl function checks for matches, and the ! operator negates the condition to exclude matches. Exclude a Specific Problematic Geopackage: problematic_gpkg &lt;- paste0(path_to_master,&quot;/Erica/Erica Backup/Ericabutterflies.gpkg&quot;) all_gpkgs &lt;- all_gpkgs[all_gpkgs != problematic_gpkg] This code defines a specific geopackage file path that is “problematic” and then removes this file from the all_gpkgs vector. Reading All Geopackages into a List: myfiles &lt;- lapply(all_gpkgs, st_read) The lapply function is used here to apply the st_read function to each file path in the all_gpkgs vector. The result is a list, with each element being the content of a geopackage file stored as an spatial features dataframe. The st_read function is part of the sf package in R and is used to read spatial data. In summary, this code: - Sets a path to a master directory. - Lists all geopackage files from this directory and its subdirectories. - Filters and excludes certain geopackages based on keywords or specific filenames. - Reads the content of each remaining geopackage file into a list. 3.4 Data cleaning and preparation Most of this is self explanatory or is a bit tedious to explain. I would recommended investigating and exploring the data before the cleaning and preparation so that some of the lines make more sense. But here are a few notable things: Each student have a backup folder embedded in their folder, these geopackages are removed in line 72 There is separate geopackage for tree data collected, this is included in the dashboard so is cleaned separately and then joined to the rest. The Species column contains the name of the species recorded, whether this is the scientific name, the common name or anything else. So all the naming columns are coalesced into one column called Species. Line 135 was necessary because for some reason empty entries in the relevant columns were “” and not NA Some of the code could be a little less sausage making-ish and could be simplified (somethings were added after the fact etc), feel free to make it more efficient! SUMMARY: Coordinate Transformation: Transforms the coordinate reference system of spatial data to standard latitude and longitude (EPSG:4326). # Transform coordinate reference system from WGS 84 / Pseudo-Mercator to standard lat long (EPSG:4326) taxa_dat &lt;- lapply(myfiles, function(x) st_transform(x, 4326)) Data Conversions: Converts the spatial data frames to regular data frames. Names each data frame in the list based on the geopackage filename. Removes duplicate data frames based on their names. # Convert spatial data frames to regular data frames taxa_dat &lt;- lapply(taxa_dat, as.data.frame) # Name each data frame in the list based on the geopackage filename names(taxa_dat) &lt;- basename(all_gpkgs) # Remove any duplicate data frames by name taxa_dat &lt;- taxa_dat[!duplicated(names(taxa_dat))] Tree Entries Package Preparation: Modifies columns for a specific geopackage (‘Tree Species Entries.gpkg’) to ensure compatibility with subsequent operations. Cleans and modifies species names. Sets certain columns to specific values or NA. Filters and selects specific columns. # Modify certain columns for &#39;Tree Species Entries.gpkg&#39; so that bind_rows works taxa_dat$`Tree Species Entries.gpkg` &lt;- taxa_dat$`Tree Species Entries.gpkg` %&gt;% rename(Species = 1, Date = 2) %&gt;% mutate( Species = case_when( Species %in% c(&quot;unknown/other&quot;, &quot;Unknown/other&quot;) ~ comments.unlisted.species, Species == &quot;Unknown young pine &quot; ~ &quot;Unknown young pine&quot;, Species == &quot;Willow x10&quot; ~ &quot;Willow&quot;, TRUE ~ Species ), taxa = &quot;Vascular Plants&quot;, Observer = NA, photoid = NA, Count = NA, Other = NA, Speciesful = NA ) %&gt;% filter(Species != &quot;&quot;) %&gt;% select(Species, Date, taxa, Count) Date Processing: Converts, splits, and extracts components (year, month, day) of the ‘Date’ column. # Date Processing: Convert, split and extract components of the &#39;Date&#39; column taxa_dat &lt;- lapply(taxa_dat, function(df) { df$Date &lt;- as.character(df$Date) df &lt;- df %&gt;% separate(Date, into = c(&quot;date&quot;, &quot;time&quot;), sep = &quot; (?=[^ ]+$)&quot;) %&gt;% mutate( date = ymd(gsub(&quot;/&quot;, &quot;-&quot;, date)), year = year(date), month = month(date), day = day(date) ) return(df) }) Tree Data Extraction: Removes the tree data frame from the list and stores it separately. # Extract and remove the tree dataframe from the list tree_data &lt;- taxa_dat$`Tree Species Entries.gpkg` taxa_dat$`Tree Species Entries.gpkg` &lt;- NULL Combining Data: Merges all data frames in the list into a single data frame. # Combine all data frames in the list into a single data frame taxa_comb &lt;- bind_rows(taxa_dat) Data Cleaning and Transformation: Performs several operations to clean and transform the combined data, including: Date conversions and modifications. Handling missing values. Excluding certain records. Recoding values in various columns. Selecting and renaming columns. # Clean and transform taxa data for further analysis taxa_clean &lt;- taxa_comb %&gt;% drop_na(taxa) %&gt;% as.character(df$Date) %&gt;% separate(Date, into = c(&quot;date&quot;, &quot;time&quot;), sep = &quot; (?=[^ ]+$)&quot;) %&gt;% mutate( date = ymd(gsub(&quot;/&quot;, &quot;-&quot;, date)), year = year(date), month = month(date), day = day(date) ) %&gt;% filter(!(taxa == &quot;hoverfly&quot; &amp; Observer == &quot;Erica&quot;)) %&gt;% # remove Erica hoverfly entries unite(collapsed_species, specieslatin:seaweedlatin, sep = &quot;,&quot;, na.rm = TRUE) %&gt;% mutate_at(vars(Species, collapsed_species), na_if, &quot;&quot;) %&gt;% mutate( Species = coalesce(Species, SpeciesSci, Speciesfull, collapsed_species, species, Other), photoid = if_else(is.na(photoid), NA, paste0(photoid, &quot;.jpg&quot;)), Count = ifelse(is.na(Count), 1, Count), taxa = recode(taxa, tree = &quot;Vascular Plants&quot;), year = recode(year, `2023` = &quot;2022/2023&quot;, `2022` = &quot;2022/2023&quot;) ) %&gt;% filter(!str_detect(Species, &quot;(?i)unknown&quot;), taxa != &quot;bee&quot;) %&gt;% filter_at(vars(taxa, Observer), all_vars(!is.na(.))) %&gt;% mutate( taxa = recode(taxa, plant = &quot;Vascular Plants&quot;, bird = &quot;Birds&quot;, macromoth = &quot;Macromoths&quot;, micromoth = &quot;Micromoths&quot;, butterfly = &quot;Butterflies&quot;, dragonfly = &quot;Dragonflies&quot;, hoverfly = &quot;Hoverflies&quot;, bat = &quot;Bats&quot;, amphibian = &quot;Amphibians&quot;, reptileamphibian = &quot;Amphibians&quot;, bumblebee = &quot;Bumblebee&quot;, mammal = &quot;Mammals&quot;, ladybird = &quot;Ladybirds&quot;, tree = &quot;Vascular Plants&quot;), year = recode(year, &quot;2023&quot; = &quot;2022/2023&quot;, &quot;2022&quot; = &quot;2022/2023&quot;), Observer = recode(Observer, Other1 = &quot;Cori&quot;)) %&gt;% select(Species, SpeciesSci, Count, date, Observer, taxa, photoid, geometry, year, day) %&gt;% rename( Date = date, Taxa = taxa, PhotoID = photoid ) Merging Tree Data with Cleaned Data: Prepares the tree data to be merged with the cleaned data. Merges both datasets. # tree data prep for bind tree_data &lt;- tree_data %&gt;% mutate( year = ifelse(year == &quot;2023&quot; | year == &quot;2022&quot;, &quot;2022/2023&quot;, year), Count = 1 # add column count ) %&gt;% rename( Date = date, Taxa = taxa ) # Merge tree data with the cleaned data all_years &lt;- bind_rows(taxa_clean, tree_data) Geometry Processing: Splits the geometry column into separate latitude and longitude columns. # split into lat and long for mapping all_years &lt;- all_years %&gt;% mutate(long = unlist(map(geometry,1)), lat = unlist(map(geometry,2))) Saving the Resulting Data: Saves the final data frame both as an RData object and as a CSV file. # Save the resulting dataframe save(all_years, file = &quot;all_years.RData&quot;) write.csv(all_years, file = &quot;all_years.csv&quot;) 3.5 Pulling photos and documents from OneDrive 3.5.1 Photos Reading Team Photos from a Directory: # read in all photo files within Survey_Photos in OneDrive Folder all_Tphotos &lt;- list.files( path = paste0(path_to_master,&quot;/Team_data&quot;), recursive = TRUE, pattern = &quot;\\\\.jpg$&quot;, full.names = FALSE ) This is the same as the first few lines of code, except that the path is constructed by appending “/Team_data” to the path_to_master. The result is stored in all_Tphotos, which will be a vector of filenames (with “.jpg” extension) from the specified directory and its subdirectories. Constructing a Destination Path for Team Photos: www_Tfolder_path &lt;- file.path(getwd(), &quot;www/Team_Data&quot;) This line constructs a path by combining the current working directory (obtained using getwd()) with “www/Team_Data”. Copying the Team Photos: photo_move &lt;- file.copy( from = file.path(paste0(path_to_master,&quot;/Team_data&quot;), all_Tphotos), to = file.path(paste(www_Tfolder_path), all_Tphotos) ) Here, file.copy is used to copy files. The from argument constructs the full paths of the source files, and the to argument constructs the full paths of the destination. The photos are copied from the source directory to the destination. The same process as above is then done for the Survey Photos. In summary, the code is designed to: Read all “.jpg” files from “Team_data” and “Survey_Photos” directories (including subdirectories). Copy those files to two new destinations under the “www” folder in the current working directory. 3.5.2 Documents The code for downloading and saving the students’ about me descriptions is very similar to the process above. The only addition is that the text of the “student_aboutme” word document is then extracted and saved into an object called “student_text”. Then the text is split into paragraphs. 3.6 Things to think about How will the next years data be included? In the same folder? New QGIS folder? "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
