<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Server | BMP Dashboard Manual</title>
  <meta name="description" content="5 Server | BMP Dashboard Manual" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Server | BMP Dashboard Manual" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Server | BMP Dashboard Manual" />
  
  
  

<meta name="author" content="AnÃ© Cloete" />


<meta name="date" content="2023-10-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ui.html"/>
<link rel="next" href="next-steps.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">BMP Dashboard Manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Hi :)</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#owners"><i class="fa fa-check"></i><b>1.1</b> Owners</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="files-within-folders-and-folders-within-files-and-more-files.html"><a href="files-within-folders-and-folders-within-files-and-more-files.html"><i class="fa fa-check"></i><b>2</b> Files within folders and folders within files and more files</a>
<ul>
<li class="chapter" data-level="2.1" data-path="files-within-folders-and-folders-within-files-and-more-files.html"><a href="files-within-folders-and-folders-within-files-and-more-files.html#biodiversity-kpi-mapping-master"><i class="fa fa-check"></i><b>2.1</b> Biodiversity KPI mapping Master</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="files-within-folders-and-folders-within-files-and-more-files.html"><a href="files-within-folders-and-folders-within-files-and-more-files.html#biodiversity-survey-master"><i class="fa fa-check"></i><b>2.1.1</b> Biodiversity Survey Master</a></li>
<li class="chapter" data-level="2.1.2" data-path="files-within-folders-and-folders-within-files-and-more-files.html"><a href="files-within-folders-and-folders-within-files-and-more-files.html#team_data"><i class="fa fa-check"></i><b>2.1.2</b> Team_Data</a></li>
<li class="chapter" data-level="2.1.3" data-path="files-within-folders-and-folders-within-files-and-more-files.html"><a href="files-within-folders-and-folders-within-files-and-more-files.html#survey_photos"><i class="fa fa-check"></i><b>2.1.3</b> Survey_Photos</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="files-within-folders-and-folders-within-files-and-more-files.html"><a href="files-within-folders-and-folders-within-files-and-more-files.html#bmpdashboard"><i class="fa fa-check"></i><b>2.2</b> BMPDashboard</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="files-within-folders-and-folders-within-files-and-more-files.html"><a href="files-within-folders-and-folders-within-files-and-more-files.html#remotedatapullprepare.r"><i class="fa fa-check"></i><b>2.2.1</b> RemoteDataPullPrepare.R</a></li>
<li class="chapter" data-level="2.2.2" data-path="files-within-folders-and-folders-within-files-and-more-files.html"><a href="files-within-folders-and-folders-within-files-and-more-files.html#global.r-ui.r-and-server.r"><i class="fa fa-check"></i><b>2.2.2</b> global.R, ui.R and server.R</a></li>
<li class="chapter" data-level="2.2.3" data-path="files-within-folders-and-folders-within-files-and-more-files.html"><a href="files-within-folders-and-folders-within-files-and-more-files.html#tabitems"><i class="fa fa-check"></i><b>2.2.3</b> TabItems</a></li>
<li class="chapter" data-level="2.2.4" data-path="files-within-folders-and-folders-within-files-and-more-files.html"><a href="files-within-folders-and-folders-within-files-and-more-files.html#modules"><i class="fa fa-check"></i><b>2.2.4</b> Modules</a></li>
<li class="chapter" data-level="2.2.5" data-path="files-within-folders-and-folders-within-files-and-more-files.html"><a href="files-within-folders-and-folders-within-files-and-more-files.html#www"><i class="fa fa-check"></i><b>2.2.5</b> www</a></li>
<li class="chapter" data-level="2.2.6" data-path="files-within-folders-and-folders-within-files-and-more-files.html"><a href="files-within-folders-and-folders-within-files-and-more-files.html#readme.md"><i class="fa fa-check"></i><b>2.2.6</b> README.md</a></li>
<li class="chapter" data-level="2.2.7" data-path="files-within-folders-and-folders-within-files-and-more-files.html"><a href="files-within-folders-and-folders-within-files-and-more-files.html#packages.r"><i class="fa fa-check"></i><b>2.2.7</b> packages.R</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="the-data.html"><a href="the-data.html"><i class="fa fa-check"></i><b>3</b> The Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="the-data.html"><a href="the-data.html#setting-up-onedrive"><i class="fa fa-check"></i><b>3.1</b> Setting up OneDrive</a></li>
<li class="chapter" data-level="3.2" data-path="the-data.html"><a href="the-data.html#getting-the-data"><i class="fa fa-check"></i><b>3.2</b> Getting the data</a></li>
<li class="chapter" data-level="3.3" data-path="the-data.html"><a href="the-data.html#data-cleaning-and-preparation"><i class="fa fa-check"></i><b>3.3</b> Data cleaning and preparation</a></li>
<li class="chapter" data-level="3.4" data-path="the-data.html"><a href="the-data.html#pulling-photos-and-documents-from-onedrive"><i class="fa fa-check"></i><b>3.4</b> Pulling photos and documents from OneDrive</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="the-data.html"><a href="the-data.html#photos"><i class="fa fa-check"></i><b>3.4.1</b> Photos</a></li>
<li class="chapter" data-level="3.4.2" data-path="the-data.html"><a href="the-data.html#documents"><i class="fa fa-check"></i><b>3.4.2</b> Documents</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="the-data.html"><a href="the-data.html#things-to-think-about"><i class="fa fa-check"></i><b>3.5</b> Things to think about</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ui.html"><a href="ui.html"><i class="fa fa-check"></i><b>4</b> UI</a>
<ul>
<li class="chapter" data-level="4.1" data-path="ui.html"><a href="ui.html#ui.r"><i class="fa fa-check"></i><b>4.1</b> ui.R</a></li>
<li class="chapter" data-level="4.2" data-path="ui.html"><a href="ui.html#tabs"><i class="fa fa-check"></i><b>4.2</b> Tabs</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="ui.html"><a href="ui.html#tab_about"><i class="fa fa-check"></i><b>4.2.1</b> Tab_About</a></li>
<li class="chapter" data-level="4.2.2" data-path="ui.html"><a href="ui.html#tab_kpi"><i class="fa fa-check"></i><b>4.2.2</b> Tab_KPI</a></li>
<li class="chapter" data-level="4.2.3" data-path="ui.html"><a href="ui.html#tab_taxa_explorer"><i class="fa fa-check"></i><b>4.2.3</b> Tab_Taxa_Explorer</a></li>
<li class="chapter" data-level="4.2.4" data-path="ui.html"><a href="ui.html#tab_student_engagement"><i class="fa fa-check"></i><b>4.2.4</b> Tab_Student_Engagement</a></li>
<li class="chapter" data-level="4.2.5" data-path="ui.html"><a href="ui.html#tab_record_finder"><i class="fa fa-check"></i><b>4.2.5</b> Tab_Record_Finder</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="server.html"><a href="server.html"><i class="fa fa-check"></i><b>5</b> Server</a>
<ul>
<li class="chapter" data-level="5.1" data-path="server.html"><a href="server.html#setup"><i class="fa fa-check"></i><b>5.1</b> Setup</a></li>
<li class="chapter" data-level="5.2" data-path="server.html"><a href="server.html#valuebox-module"><i class="fa fa-check"></i><b>5.2</b> Valuebox Module</a></li>
<li class="chapter" data-level="5.3" data-path="server.html"><a href="server.html#tab-about"><i class="fa fa-check"></i><b>5.3</b> Tab About</a></li>
<li class="chapter" data-level="5.4" data-path="server.html"><a href="server.html#tab-kpi"><i class="fa fa-check"></i><b>5.4</b> Tab KPI</a></li>
<li class="chapter" data-level="5.5" data-path="server.html"><a href="server.html#tab-taxa-explorer"><i class="fa fa-check"></i><b>5.5</b> Tab Taxa Explorer</a></li>
<li class="chapter" data-level="5.6" data-path="server.html"><a href="server.html#tab-student-engagement"><i class="fa fa-check"></i><b>5.6</b> Tab Student Engagement</a></li>
<li class="chapter" data-level="5.7" data-path="server.html"><a href="server.html#tab-record-finder"><i class="fa fa-check"></i><b>5.7</b> Tab Record Finder</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="next-steps.html"><a href="next-steps.html"><i class="fa fa-check"></i><b>6</b> Next Steps</a>
<ul>
<li class="chapter" data-level="6.1" data-path="next-steps.html"><a href="next-steps.html#error-message-record-finder"><i class="fa fa-check"></i><b>6.1</b> Error message Record Finder</a></li>
<li class="chapter" data-level="6.2" data-path="next-steps.html"><a href="next-steps.html#different-years-different-data"><i class="fa fa-check"></i><b>6.2</b> Different years different data:</a></li>
<li class="chapter" data-level="6.3" data-path="next-steps.html"><a href="next-steps.html#data-download-and-clean-automation"><i class="fa fa-check"></i><b>6.3</b> Data download and clean automation:</a></li>
<li class="chapter" data-level="6.4" data-path="next-steps.html"><a href="next-steps.html#survey-photos"><i class="fa fa-check"></i><b>6.4</b> Survey Photos:</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="useful-things.html"><a href="useful-things.html"><i class="fa fa-check"></i><b>7</b> Useful things</a>
<ul>
<li class="chapter" data-level="7.1" data-path="useful-things.html"><a href="useful-things.html#reactive-expressions"><i class="fa fa-check"></i><b>7.1</b> Reactive Expressions</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="useful-things.html"><a href="useful-things.html#reactivity"><i class="fa fa-check"></i><b>7.1.1</b> 1. <strong>Reactivity:</strong></a></li>
<li class="chapter" data-level="7.1.2" data-path="useful-things.html"><a href="useful-things.html#understanding-reactive-expressions"><i class="fa fa-check"></i><b>7.1.2</b> 2. <strong>Understanding Reactive Expressions:</strong></a></li>
<li class="chapter" data-level="7.1.3" data-path="useful-things.html"><a href="useful-things.html#declaration-of-reactive-expressions"><i class="fa fa-check"></i><b>7.1.3</b> 3. <strong>Declaration of Reactive Expressions:</strong></a></li>
<li class="chapter" data-level="7.1.4" data-path="useful-things.html"><a href="useful-things.html#dependency-tracking"><i class="fa fa-check"></i><b>7.1.4</b> 4. <strong>Dependency Tracking:</strong></a></li>
<li class="chapter" data-level="7.1.5" data-path="useful-things.html"><a href="useful-things.html#use-in-output-elements"><i class="fa fa-check"></i><b>7.1.5</b> 5. <strong>Use in Output Elements:</strong></a></li>
<li class="chapter" data-level="7.1.6" data-path="useful-things.html"><a href="useful-things.html#reactivity-in-observe-and-eventreactive"><i class="fa fa-check"></i><b>7.1.6</b> 6. <strong>Reactivity in <code>observe()</code> and <code>eventReactive()</code>:</strong></a></li>
<li class="chapter" data-level="7.1.7" data-path="useful-things.html"><a href="useful-things.html#use-cases"><i class="fa fa-check"></i><b>7.1.7</b> 7. <strong>Use Cases:</strong></a></li>
<li class="chapter" data-level="7.1.8" data-path="useful-things.html"><a href="useful-things.html#performance-considerations"><i class="fa fa-check"></i><b>7.1.8</b> 8. <strong>Performance Considerations:</strong></a></li>
<li class="chapter" data-level="7.1.9" data-path="useful-things.html"><a href="useful-things.html#reactive-conductors"><i class="fa fa-check"></i><b>7.1.9</b> 9. <strong>Reactive Conductors:</strong></a></li>
<li class="chapter" data-level="7.1.10" data-path="useful-things.html"><a href="useful-things.html#isolation-of-reactivity"><i class="fa fa-check"></i><b>7.1.10</b> 10. <strong>Isolation of Reactivity:</strong></a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">BMP Dashboard Manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="server" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">5</span> Server<a href="server.html#server" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In the server.R file we define the server side of the shiny app. The code is neatly commented so that you can navigate to the server code for each of the tab panels:</p>
<p><img src="images/server.png" /></p>
<p>Before that though, we do some NB things:</p>
<div id="setup" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Setup<a href="server.html#setup" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>1. Fetching Data:</strong></p>
<p>Reactive expression (<code>survey_data</code>) fetches data based on the user-selected year (<code>input$year</code>) from a list of data frames (<code>all_years_list</code>). Here we subset the data for the year the user selects and store in a reactive dataframe. If youâre unfamiliar with reactive expressions, refer to the Master Shiny textbook! You can also look at the useful things section of this book, where Iâve provided some explanations of random shiny things.</p>
<p>The data frame corresponding to the selected year is stored in <code>extract_df</code>, and the reactive expression returns this subset of data. Now âsurvey_dataâ is a reactive dataset and is called throughout the shiny app likes its a function, i.e.Â âsurvey_data()â.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="server.html#cb32-1" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb32-2"><a href="server.html#cb32-2" tabindex="-1"></a>  extract_df <span class="ot">&lt;-</span> all_years_list[[input<span class="sc">$</span>year]]</span>
<span id="cb32-3"><a href="server.html#cb32-3" tabindex="-1"></a>  <span class="fu">return</span>(extract_df)</span>
<span id="cb32-4"><a href="server.html#cb32-4" tabindex="-1"></a>})</span></code></pre></div>
<p><strong>2. Taxa Names for Taxa Explorer:</strong></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="server.html#cb33-1" tabindex="-1"></a>taxa_names <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb33-2"><a href="server.html#cb33-2" tabindex="-1"></a>  <span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">survey_data</span>()<span class="sc">$</span>Taxa))</span>
<span id="cb33-3"><a href="server.html#cb33-3" tabindex="-1"></a>})</span></code></pre></div>
<p>This reactive expression (<code>taxa_names</code>) generates a sorted list of unique taxa names based on the currently selected survey data. We call the reactive dataset and then extrac and sort the unique entries in the Taxa column. The resulting reactive object taxa_names is then used to populate the dropdown menu in for the Taxa Explorer tab.</p>
<p><strong>3. Student Names for Student Engagement:</strong></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="server.html#cb34-1" tabindex="-1"></a>student_names <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb34-2"><a href="server.html#cb34-2" tabindex="-1"></a>  <span class="fu">survey_data</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="server.html#cb34-3" tabindex="-1"></a>    <span class="fu">distinct</span>(Observer, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-4"><a href="server.html#cb34-4" tabindex="-1"></a>    <span class="fu">drop_na</span>(Observer) <span class="sc">%&gt;%</span></span>
<span id="cb34-5"><a href="server.html#cb34-5" tabindex="-1"></a>    <span class="fu">pull</span>(Observer)</span>
<span id="cb34-6"><a href="server.html#cb34-6" tabindex="-1"></a>})</span></code></pre></div>
<p>Here we do the same thing as in the previous block but for the student names. A few extra things are done: any duplicate observer names and NA values. The result is a list of student names for populating the dropdown menu in the Student Engagement tab.</p>
<p><strong>4. Updating Taxa and Student Selection:</strong></p>
<p>In the follwoing blocks of code, we take the reactive objects <code>taxa_names</code> and <code>student_names</code> and we update the dropdown menus:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="server.html#cb35-1" tabindex="-1"></a><span class="fu">observeEvent</span>(input<span class="sc">$</span>year,</span>
<span id="cb35-2"><a href="server.html#cb35-2" tabindex="-1"></a>  {</span>
<span id="cb35-3"><a href="server.html#cb35-3" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>year <span class="sc">==</span> <span class="st">&quot;2022/2023&quot;</span>) {</span>
<span id="cb35-4"><a href="server.html#cb35-4" tabindex="-1"></a>      <span class="fu">updateSelectInput</span>(session, <span class="st">&quot;taxa_select&quot;</span>, <span class="at">choices =</span> <span class="fu">taxa_names</span>(), <span class="at">selected =</span> <span class="st">&quot;Butterflies&quot;</span>)</span>
<span id="cb35-5"><a href="server.html#cb35-5" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb35-6"><a href="server.html#cb35-6" tabindex="-1"></a>      <span class="fu">updateSelectInput</span>(session, <span class="st">&quot;taxa_select&quot;</span>, <span class="at">choices =</span> <span class="fu">taxa_names</span>())</span>
<span id="cb35-7"><a href="server.html#cb35-7" tabindex="-1"></a>    }</span>
<span id="cb35-8"><a href="server.html#cb35-8" tabindex="-1"></a>  },</span>
<span id="cb35-9"><a href="server.html#cb35-9" tabindex="-1"></a>  <span class="at">ignoreNULL =</span> <span class="cn">FALSE</span></span>
<span id="cb35-10"><a href="server.html#cb35-10" tabindex="-1"></a>)</span></code></pre></div>
<p>If the selected year is â2022/2023,â it updates the choices in the taxa dropdown menu (<code>taxa_select</code>) with <code>taxa_names()</code> and sets the default selected value to âButterflies.â Otherwise, it updates the choices without a default selection.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="server.html#cb36-1" tabindex="-1"></a><span class="fu">observeEvent</span>(input<span class="sc">$</span>year,</span>
<span id="cb36-2"><a href="server.html#cb36-2" tabindex="-1"></a>  {</span>
<span id="cb36-3"><a href="server.html#cb36-3" tabindex="-1"></a>    <span class="fu">updateSelectInput</span>(session, <span class="st">&quot;student_select&quot;</span>, <span class="at">choices =</span> <span class="fu">student_names</span>())</span>
<span id="cb36-4"><a href="server.html#cb36-4" tabindex="-1"></a>  },</span>
<span id="cb36-5"><a href="server.html#cb36-5" tabindex="-1"></a>  <span class="at">ignoreNULL =</span> <span class="cn">FALSE</span></span>
<span id="cb36-6"><a href="server.html#cb36-6" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="valuebox-module" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Valuebox Module<a href="server.html#valuebox-module" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Letâs go through how the shiny module for the custom valuebox is created. Open the âvaluebox_module.Râ script in the Modules folder. I modified the code from this link and used <a href="https://jkunst.com/blog/posts/2020-06-26-valuebox-and-sparklines/">this website</a> as well. I mainly did this because I wnated more control over the appearance of the valueboxes. The standard valuebox from shinydashboard can only have select colors etc.</p>
<ol style="list-style-type: decimal">
<li><strong><code>customValueBox</code> Function:</strong>
<ul>
<li><strong>Purpose:</strong> This function creates the HTML structure for a custom value box.</li>
<li><strong>Parameters:</strong>
<ul>
<li><code>value</code>: The main value displayed in the value box.</li>
<li><code>subtitle</code>: Additional text displayed below the main value.</li>
<li><code>icon</code>: An optional icon to be displayed in the value box.</li>
<li><code>color</code>: Text color of the value box.</li>
<li><code>background</code>: Background color of the value box.</li>
<li><code>width</code>: Width of the value box (default is 4 columns in a 12-column grid).</li>
<li><code>height</code>: Height of the value box (default is â150pxâ).</li>
</ul></li>
<li><strong>Functionality:</strong>
<ul>
<li>The function constructs HTML elements using the provided parameters to create a custom value box.</li>
<li>It uses the <code>shinydashboard</code> packageâs internal <code>tagAssert</code> function to assert that the <code>icon</code> is of type âi.â</li>
<li>The style is constructed based on the provided colors, width, and height.</li>
<li>The <code>div</code> function is used to create the structure of the value box, including the main value, subtitle, and optional icon.</li>
</ul></li>
</ul></li>
</ol>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="server.html#cb37-1" tabindex="-1"></a><span class="co"># custom value box function </span></span>
<span id="cb37-2"><a href="server.html#cb37-2" tabindex="-1"></a></span>
<span id="cb37-3"><a href="server.html#cb37-3" tabindex="-1"></a>customValueBox <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">value =</span> <span class="cn">NULL</span>, <span class="at">subtitle =</span> <span class="cn">NULL</span>, <span class="at">icon =</span> <span class="cn">NULL</span>, color, background, </span>
<span id="cb37-4"><a href="server.html#cb37-4" tabindex="-1"></a>                           <span class="at">width =</span> <span class="dv">4</span>, <span class="at">height =</span> <span class="st">&quot;150px&quot;</span>){</span>
<span id="cb37-5"><a href="server.html#cb37-5" tabindex="-1"></a>  </span>
<span id="cb37-6"><a href="server.html#cb37-6" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(icon))</span>
<span id="cb37-7"><a href="server.html#cb37-7" tabindex="-1"></a>    shinydashboard<span class="sc">:::</span><span class="fu">tagAssert</span>(icon, <span class="at">type =</span> <span class="st">&quot;i&quot;</span>)</span>
<span id="cb37-8"><a href="server.html#cb37-8" tabindex="-1"></a>  </span>
<span id="cb37-9"><a href="server.html#cb37-9" tabindex="-1"></a>  style <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;color: &quot;</span>, color, <span class="st">&quot;; background-color: &quot;</span>, background, <span class="st">&quot;;&quot;</span>,</span>
<span id="cb37-10"><a href="server.html#cb37-10" tabindex="-1"></a>                  <span class="st">&quot;width: &quot;</span>,width,  <span class="st">&quot;;&quot;</span>, <span class="st">&quot;height: &quot;</span>, height)</span>
<span id="cb37-11"><a href="server.html#cb37-11" tabindex="-1"></a>  </span>
<span id="cb37-12"><a href="server.html#cb37-12" tabindex="-1"></a>  boxContent <span class="ot">&lt;-</span> <span class="fu">div</span>(</span>
<span id="cb37-13"><a href="server.html#cb37-13" tabindex="-1"></a>    <span class="at">class =</span> <span class="st">&quot;small-box&quot;</span>, <span class="at">style =</span> style,</span>
<span id="cb37-14"><a href="server.html#cb37-14" tabindex="-1"></a>    <span class="fu">div</span>(</span>
<span id="cb37-15"><a href="server.html#cb37-15" tabindex="-1"></a>      <span class="at">class =</span> <span class="st">&quot;inner&quot;</span>,</span>
<span id="cb37-16"><a href="server.html#cb37-16" tabindex="-1"></a>      <span class="fu">h4</span>(value),</span>
<span id="cb37-17"><a href="server.html#cb37-17" tabindex="-1"></a>      <span class="fu">p</span>(subtitle)</span>
<span id="cb37-18"><a href="server.html#cb37-18" tabindex="-1"></a>    ),</span>
<span id="cb37-19"><a href="server.html#cb37-19" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(icon)) <span class="fu">div</span>(<span class="at">class =</span> <span class="st">&quot;icon-large&quot;</span>, icon)</span>
<span id="cb37-20"><a href="server.html#cb37-20" tabindex="-1"></a>  )</span>
<span id="cb37-21"><a href="server.html#cb37-21" tabindex="-1"></a>  </span>
<span id="cb37-22"><a href="server.html#cb37-22" tabindex="-1"></a>  <span class="fu">div</span>(</span>
<span id="cb37-23"><a href="server.html#cb37-23" tabindex="-1"></a>    <span class="at">class =</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(width)) <span class="fu">paste0</span>(<span class="st">&quot;col-sm-&quot;</span>, width), </span>
<span id="cb37-24"><a href="server.html#cb37-24" tabindex="-1"></a>    boxContent</span>
<span id="cb37-25"><a href="server.html#cb37-25" tabindex="-1"></a>  )</span>
<span id="cb37-26"><a href="server.html#cb37-26" tabindex="-1"></a>}</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><strong><code>valuebox_server</code> Function:</strong>
<ul>
<li><strong>Purpose:</strong> This function serves as the server logic for the value box module.</li>
<li><strong>Parameters:</strong>
<ul>
<li><code>id</code>: A unique identifier for the value box.</li>
<li>Other parameters are passed to the <code>customValueBox</code> function.</li>
</ul></li>
<li><strong>Functionality:</strong>
<ul>
<li>It uses the <code>moduleServer</code> function to define a Shiny module.</li>
<li>The <code>renderValueBox</code> function is used to render the value box based on the inputs.</li>
<li>The <code>customValueBox</code> function is called with the provided parameters.</li>
</ul></li>
</ul></li>
</ol>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="server.html#cb38-1" tabindex="-1"></a><span class="co"># valuebox module server function ---------------------------------------------</span></span>
<span id="cb38-2"><a href="server.html#cb38-2" tabindex="-1"></a></span>
<span id="cb38-3"><a href="server.html#cb38-3" tabindex="-1"></a>valuebox_server <span class="ot">&lt;-</span> <span class="cf">function</span>(id, value, subtitle, icon, color, background, </span>
<span id="cb38-4"><a href="server.html#cb38-4" tabindex="-1"></a>                            <span class="at">width =</span> <span class="dv">4</span>, <span class="at">height =</span> <span class="st">&quot;150px&quot;</span>){</span>
<span id="cb38-5"><a href="server.html#cb38-5" tabindex="-1"></a>  <span class="fu">moduleServer</span>(id, <span class="cf">function</span>(input, output, session){</span>
<span id="cb38-6"><a href="server.html#cb38-6" tabindex="-1"></a>    output<span class="sc">$</span>vb <span class="ot">&lt;-</span> <span class="fu">renderValueBox</span>({</span>
<span id="cb38-7"><a href="server.html#cb38-7" tabindex="-1"></a>      <span class="fu">customValueBox</span>(</span>
<span id="cb38-8"><a href="server.html#cb38-8" tabindex="-1"></a>        <span class="at">value =</span> value, </span>
<span id="cb38-9"><a href="server.html#cb38-9" tabindex="-1"></a>        <span class="at">subtitle =</span> subtitle,</span>
<span id="cb38-10"><a href="server.html#cb38-10" tabindex="-1"></a>        <span class="at">icon =</span> icon,</span>
<span id="cb38-11"><a href="server.html#cb38-11" tabindex="-1"></a>        <span class="at">background =</span> background,</span>
<span id="cb38-12"><a href="server.html#cb38-12" tabindex="-1"></a>        <span class="at">color =</span> color,</span>
<span id="cb38-13"><a href="server.html#cb38-13" tabindex="-1"></a>        <span class="at">width =</span> width,</span>
<span id="cb38-14"><a href="server.html#cb38-14" tabindex="-1"></a>        <span class="at">height =</span> height</span>
<span id="cb38-15"><a href="server.html#cb38-15" tabindex="-1"></a>      )</span>
<span id="cb38-16"><a href="server.html#cb38-16" tabindex="-1"></a>    })</span>
<span id="cb38-17"><a href="server.html#cb38-17" tabindex="-1"></a>  })</span>
<span id="cb38-18"><a href="server.html#cb38-18" tabindex="-1"></a>}</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li><strong>Usage Example:</strong>
<ul>
<li>To use this module in a Shiny application, you would call the <code>valuebox_server</code> function in the server part of your Shiny app and use <code>valueBoxOutput</code> in the UI part.</li>
<li>Example:</li>
</ul></li>
</ol>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="server.html#cb39-1" tabindex="-1"></a>     output<span class="sc">$</span>myValueBox <span class="ot">&lt;-</span> <span class="fu">valuebox_server</span>(</span>
<span id="cb39-2"><a href="server.html#cb39-2" tabindex="-1"></a>       <span class="at">id =</span> <span class="st">&quot;myValueBox&quot;</span>,</span>
<span id="cb39-3"><a href="server.html#cb39-3" tabindex="-1"></a>       <span class="at">value =</span> <span class="dv">42</span>,</span>
<span id="cb39-4"><a href="server.html#cb39-4" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Answer to the Ultimate Question of Life, the Universe, and Everything&quot;</span>,</span>
<span id="cb39-5"><a href="server.html#cb39-5" tabindex="-1"></a>       <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">&quot;star&quot;</span>),</span>
<span id="cb39-6"><a href="server.html#cb39-6" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb39-7"><a href="server.html#cb39-7" tabindex="-1"></a>       <span class="at">background =</span> <span class="st">&quot;lightblue&quot;</span>,</span>
<span id="cb39-8"><a href="server.html#cb39-8" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">4</span>,</span>
<span id="cb39-9"><a href="server.html#cb39-9" tabindex="-1"></a>       <span class="at">height =</span> <span class="st">&quot;150px&quot;</span></span>
<span id="cb39-10"><a href="server.html#cb39-10" tabindex="-1"></a>     )</span></code></pre></div>
</div>
<div id="tab-about" class="section level2 hasAnchor" number="5.3">
<h2><span class="header-section-number">5.3</span> Tab About<a href="server.html#tab-about" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Here the server side of the valueboxes that are in the Tab_About UI are made and we use the paragraphs from the Tab_About.R;</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="server.html#cb40-1" tabindex="-1"></a><span class="co"># from Tab_About.R </span></span>
<span id="cb40-2"><a href="server.html#cb40-2" tabindex="-1"></a></span>
<span id="cb40-3"><a href="server.html#cb40-3" tabindex="-1"></a><span class="co"># Descriptions for server side valueboxes</span></span>
<span id="cb40-4"><a href="server.html#cb40-4" tabindex="-1"></a></span>
<span id="cb40-5"><a href="server.html#cb40-5" tabindex="-1"></a><span class="co"># ABI score descriptions</span></span>
<span id="cb40-6"><a href="server.html#cb40-6" tabindex="-1"></a>par_s_h <span class="ot">&lt;-</span> <span class="st">&quot;Description of species and habitat score.&quot;</span></span>
<span id="cb40-7"><a href="server.html#cb40-7" tabindex="-1"></a></span>
<span id="cb40-8"><a href="server.html#cb40-8" tabindex="-1"></a>par_area <span class="ot">&lt;-</span> <span class="st">&quot;Description of area managed for biodiversity score&quot;</span></span>
<span id="cb40-9"><a href="server.html#cb40-9" tabindex="-1"></a></span>
<span id="cb40-10"><a href="server.html#cb40-10" tabindex="-1"></a>par_engage <span class="ot">&lt;-</span> <span class="st">&quot;Description of biodiversity engagement score.&quot;</span></span>
<span id="cb40-11"><a href="server.html#cb40-11" tabindex="-1"></a></span>
<span id="cb40-12"><a href="server.html#cb40-12" tabindex="-1"></a><span class="co"># BBI score descriptions</span></span>
<span id="cb40-13"><a href="server.html#cb40-13" tabindex="-1"></a>par_m_s <span class="ot">&lt;-</span> <span class="st">&quot;Description of mean species richness per hectare.&quot;</span></span>
<span id="cb40-14"><a href="server.html#cb40-14" tabindex="-1"></a></span>
<span id="cb40-15"><a href="server.html#cb40-15" tabindex="-1"></a>par_l_s <span class="ot">&lt;-</span> <span class="st">&quot;Description of local species richness per hectare.&quot;</span></span>
<span id="cb40-16"><a href="server.html#cb40-16" tabindex="-1"></a></span>
<span id="cb40-17"><a href="server.html#cb40-17" tabindex="-1"></a>par_fife <span class="ot">&lt;-</span> <span class="st">&quot;Description of Fife species richness per hectare.&quot;</span></span></code></pre></div>
<p><strong>ABI Descriptions</strong></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="server.html#cb41-1" tabindex="-1"></a>output<span class="sc">$</span>S_H_about <span class="ot">&lt;-</span> <span class="fu">valuebox_server</span>(</span>
<span id="cb41-2"><a href="server.html#cb41-2" tabindex="-1"></a>  <span class="at">id =</span> <span class="st">&quot;S_H_about&quot;</span>,</span>
<span id="cb41-3"><a href="server.html#cb41-3" tabindex="-1"></a>  <span class="at">subtitle =</span> <span class="fu">paste</span>(par_s_h),</span>
<span id="cb41-4"><a href="server.html#cb41-4" tabindex="-1"></a>  <span class="at">value =</span> <span class="st">&quot;Species and Habitat Score&quot;</span>,</span>
<span id="cb41-5"><a href="server.html#cb41-5" tabindex="-1"></a>  <span class="at">background =</span> <span class="st">&quot;lightgray&quot;</span>,</span>
<span id="cb41-6"><a href="server.html#cb41-6" tabindex="-1"></a>  <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb41-7"><a href="server.html#cb41-7" tabindex="-1"></a>  <span class="at">icon =</span> <span class="cn">NULL</span></span>
<span id="cb41-8"><a href="server.html#cb41-8" tabindex="-1"></a>) </span></code></pre></div>
<ul>
<li><p><code>output$S_H_about</code> is a Shiny output element using the <code>valuebox_server</code> function. It displays a box containing a title, subtitle, and value.</p></li>
<li><p><code>id</code>: A unique identifier for the box.</p></li>
<li><p><code>subtitle</code>: The text displayed below the title, extracted from a reactive variable (<code>par_s_h</code>).</p></li>
<li><p><code>value</code>: The main content of the box, indicating âSpecies and Habitat Score.â</p></li>
<li><p>Other parameters set the background color, text color, and icon (none in this case).</p></li>
</ul>
<p><strong>More ABI Descriptions:</strong></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="server.html#cb42-1" tabindex="-1"></a>output<span class="sc">$</span>area_about <span class="ot">&lt;-</span> <span class="fu">valuebox_server</span>(</span>
<span id="cb42-2"><a href="server.html#cb42-2" tabindex="-1"></a>  <span class="at">id =</span> <span class="st">&quot;area_about&quot;</span>,</span>
<span id="cb42-3"><a href="server.html#cb42-3" tabindex="-1"></a>  <span class="at">subtitle =</span> <span class="fu">paste</span>(par_l_s),</span>
<span id="cb42-4"><a href="server.html#cb42-4" tabindex="-1"></a>  <span class="at">value =</span> <span class="st">&quot;Area Score&quot;</span>,</span>
<span id="cb42-5"><a href="server.html#cb42-5" tabindex="-1"></a>  <span class="at">background =</span> <span class="st">&quot;lightgray&quot;</span>,</span>
<span id="cb42-6"><a href="server.html#cb42-6" tabindex="-1"></a>  <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb42-7"><a href="server.html#cb42-7" tabindex="-1"></a>  <span class="at">icon =</span> <span class="cn">NULL</span></span>
<span id="cb42-8"><a href="server.html#cb42-8" tabindex="-1"></a>) </span>
<span id="cb42-9"><a href="server.html#cb42-9" tabindex="-1"></a></span>
<span id="cb42-10"><a href="server.html#cb42-10" tabindex="-1"></a>output<span class="sc">$</span>engagement_about <span class="ot">&lt;-</span> <span class="fu">valuebox_server</span>(</span>
<span id="cb42-11"><a href="server.html#cb42-11" tabindex="-1"></a>  <span class="at">id =</span> <span class="st">&quot;engagement_about&quot;</span>,</span>
<span id="cb42-12"><a href="server.html#cb42-12" tabindex="-1"></a>  <span class="at">subtitle =</span> <span class="fu">paste</span>(par_engage),</span>
<span id="cb42-13"><a href="server.html#cb42-13" tabindex="-1"></a>  <span class="at">value =</span> <span class="st">&quot;Engagement Score&quot;</span>,</span>
<span id="cb42-14"><a href="server.html#cb42-14" tabindex="-1"></a>  <span class="at">background =</span> <span class="st">&quot;lightgray&quot;</span>,</span>
<span id="cb42-15"><a href="server.html#cb42-15" tabindex="-1"></a>  <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb42-16"><a href="server.html#cb42-16" tabindex="-1"></a>  <span class="at">icon =</span> <span class="cn">NULL</span></span>
<span id="cb42-17"><a href="server.html#cb42-17" tabindex="-1"></a>)</span></code></pre></div>
<ul>
<li>Similar to the previous example, these <code>valuebox_server</code> outputs display descriptions for different components of the Annual Biodiversity Index (ABI).</li>
</ul>
<p><strong>BBI Descriptions:</strong></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="server.html#cb43-1" tabindex="-1"></a>output<span class="sc">$</span>MS_about <span class="ot">&lt;-</span> <span class="fu">valuebox_server</span>(</span>
<span id="cb43-2"><a href="server.html#cb43-2" tabindex="-1"></a>  <span class="at">id =</span> <span class="st">&quot;MS_about&quot;</span>,</span>
<span id="cb43-3"><a href="server.html#cb43-3" tabindex="-1"></a>  <span class="at">subtitle =</span> <span class="fu">paste</span>(par_m_s),</span>
<span id="cb43-4"><a href="server.html#cb43-4" tabindex="-1"></a>  <span class="at">value =</span> <span class="st">&quot;Local species score per hectare&quot;</span>,</span>
<span id="cb43-5"><a href="server.html#cb43-5" tabindex="-1"></a>  <span class="at">background =</span> <span class="st">&quot;lightgray&quot;</span>,</span>
<span id="cb43-6"><a href="server.html#cb43-6" tabindex="-1"></a>  <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb43-7"><a href="server.html#cb43-7" tabindex="-1"></a>  <span class="at">icon =</span> <span class="cn">NULL</span></span>
<span id="cb43-8"><a href="server.html#cb43-8" tabindex="-1"></a>)</span>
<span id="cb43-9"><a href="server.html#cb43-9" tabindex="-1"></a></span>
<span id="cb43-10"><a href="server.html#cb43-10" tabindex="-1"></a>output<span class="sc">$</span>fife_about <span class="ot">&lt;-</span> <span class="fu">valuebox_server</span>(</span>
<span id="cb43-11"><a href="server.html#cb43-11" tabindex="-1"></a>  <span class="at">id =</span> <span class="st">&quot;fife_about&quot;</span>,</span>
<span id="cb43-12"><a href="server.html#cb43-12" tabindex="-1"></a>  <span class="at">subtitle =</span> <span class="fu">paste</span>(par_fife),</span>
<span id="cb43-13"><a href="server.html#cb43-13" tabindex="-1"></a>  <span class="at">value =</span> <span class="st">&quot;Local species score per hectare&quot;</span>,</span>
<span id="cb43-14"><a href="server.html#cb43-14" tabindex="-1"></a>  <span class="at">background =</span> <span class="st">&quot;lightgray&quot;</span>,</span>
<span id="cb43-15"><a href="server.html#cb43-15" tabindex="-1"></a>  <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb43-16"><a href="server.html#cb43-16" tabindex="-1"></a>  <span class="at">icon =</span> <span class="cn">NULL</span></span>
<span id="cb43-17"><a href="server.html#cb43-17" tabindex="-1"></a>)</span>
<span id="cb43-18"><a href="server.html#cb43-18" tabindex="-1"></a></span>
<span id="cb43-19"><a href="server.html#cb43-19" tabindex="-1"></a>output<span class="sc">$</span>local_about <span class="ot">&lt;-</span> <span class="fu">valuebox_server</span>(</span>
<span id="cb43-20"><a href="server.html#cb43-20" tabindex="-1"></a>  <span class="at">id =</span> <span class="st">&quot;local_about&quot;</span>,</span>
<span id="cb43-21"><a href="server.html#cb43-21" tabindex="-1"></a>  <span class="at">icon =</span> <span class="cn">NULL</span>,</span>
<span id="cb43-22"><a href="server.html#cb43-22" tabindex="-1"></a>  <span class="at">subtitle =</span> <span class="fu">paste</span>(par_l_s),</span>
<span id="cb43-23"><a href="server.html#cb43-23" tabindex="-1"></a>  <span class="at">value =</span> <span class="st">&quot;Local species score per hectare&quot;</span>,</span>
<span id="cb43-24"><a href="server.html#cb43-24" tabindex="-1"></a>  <span class="at">background =</span> <span class="st">&quot;lightgray&quot;</span>,</span>
<span id="cb43-25"><a href="server.html#cb43-25" tabindex="-1"></a>  <span class="at">color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb43-26"><a href="server.html#cb43-26" tabindex="-1"></a>)</span></code></pre></div>
<ul>
<li>These <code>valuebox_server</code> outputs display descriptions for different components of the Benchmark Biodiversity Index (BBI).</li>
</ul>
<p><strong>Summary:</strong>
This server code defines logic to render images and display descriptions for the âAboutâ tab of a Shiny application. The images include group photos, and the descriptions provide information about various biodiversity indices and scores. The data for these descriptions seems to come from reactive variables like <code>par_s_h</code>, <code>par_l_s</code>, <code>par_engage</code>, <code>par_m_s</code>, and <code>par_fife</code>.</p>
</div>
<div id="tab-kpi" class="section level2 hasAnchor" number="5.4">
<h2><span class="header-section-number">5.4</span> Tab KPI<a href="server.html#tab-kpi" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This R Shiny server code is associated with the âKey Performance Indicesâ tab (TAB 1). More valueboxes are created! And the server logic for the two graphs are created. The first one is always displayed, the second is only displayed when the year selected is not the first year.</p>
<p><strong>ABI Plot (Bar Plot):</strong></p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="server.html#cb44-1" tabindex="-1"></a>   output<span class="sc">$</span>taxa_bar <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb44-2"><a href="server.html#cb44-2" tabindex="-1"></a>     <span class="co"># Data manipulation to get species count per Taxa</span></span>
<span id="cb44-3"><a href="server.html#cb44-3" tabindex="-1"></a>     df <span class="ot">&lt;-</span> <span class="fu">survey_data</span>() <span class="sc">%&gt;%</span></span>
<span id="cb44-4"><a href="server.html#cb44-4" tabindex="-1"></a>       <span class="fu">group_by</span>(Taxa) <span class="sc">%&gt;%</span></span>
<span id="cb44-5"><a href="server.html#cb44-5" tabindex="-1"></a>       <span class="fu">summarise</span>(<span class="at">Count =</span> <span class="fu">n_distinct</span>(Species))</span>
<span id="cb44-6"><a href="server.html#cb44-6" tabindex="-1"></a></span>
<span id="cb44-7"><a href="server.html#cb44-7" tabindex="-1"></a>     <span class="co"># Plotting using ggplot2 and converting it to Plotly</span></span>
<span id="cb44-8"><a href="server.html#cb44-8" tabindex="-1"></a>     <span class="fu">ggplotly</span>(</span>
<span id="cb44-9"><a href="server.html#cb44-9" tabindex="-1"></a>       <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Taxa, <span class="sc">-</span>Count), <span class="at">y =</span> Count)) <span class="sc">+</span></span>
<span id="cb44-10"><a href="server.html#cb44-10" tabindex="-1"></a>         <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;#028E9D&quot;</span>, <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb44-11"><a href="server.html#cb44-11" tabindex="-1"></a>         <span class="fu">labs</span>(</span>
<span id="cb44-12"><a href="server.html#cb44-12" tabindex="-1"></a>           <span class="at">x =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">Taxa&quot;</span>,</span>
<span id="cb44-13"><a href="server.html#cb44-13" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">&quot;Number of Species</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb44-14"><a href="server.html#cb44-14" tabindex="-1"></a>         ) <span class="sc">+</span></span>
<span id="cb44-15"><a href="server.html#cb44-15" tabindex="-1"></a>         <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb44-16"><a href="server.html#cb44-16" tabindex="-1"></a>         <span class="fu">theme</span>(</span>
<span id="cb44-17"><a href="server.html#cb44-17" tabindex="-1"></a>           <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb44-18"><a href="server.html#cb44-18" tabindex="-1"></a>           <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb44-19"><a href="server.html#cb44-19" tabindex="-1"></a>         ),</span>
<span id="cb44-20"><a href="server.html#cb44-20" tabindex="-1"></a>       <span class="at">tooltip =</span> <span class="st">&quot;y&quot;</span></span>
<span id="cb44-21"><a href="server.html#cb44-21" tabindex="-1"></a>     )</span>
<span id="cb44-22"><a href="server.html#cb44-22" tabindex="-1"></a>   })</span></code></pre></div>
<ul>
<li><p>Within the <code>renderPlotly</code> function we group the data by taxa and count the number of unique species with tidyverse logic. This is then stored in an object called <code>df</code>. This occurs within the function, so it can only be used within the function.</p></li>
<li><p>The <code>renderPlotly</code> function generates the plot based on the species count data and uses the <code>ggplotly</code> function to convert the ggplot2 plot to a Plotly interactive plot.</p></li>
</ul>
<p><strong>Example Plot for Change (CBI):</strong></p>
<p>An example plot is provided for the Change Biodiversity Index (CBI). This plot is only shown when the selected year is not the first year (2022/2023).</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="server.html#cb45-1" tabindex="-1"></a>   output<span class="sc">$</span>example_plot <span class="ot">&lt;-</span> output<span class="sc">$</span>species_bar <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb45-2"><a href="server.html#cb45-2" tabindex="-1"></a>     <span class="co"># Example data for CBI plot</span></span>
<span id="cb45-3"><a href="server.html#cb45-3" tabindex="-1"></a>     example_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb45-4"><a href="server.html#cb45-4" tabindex="-1"></a>       <span class="at">Year =</span> <span class="fu">c</span>(<span class="st">&quot;2022/2023&quot;</span>, <span class="st">&quot;2023/2024&quot;</span>),</span>
<span id="cb45-5"><a href="server.html#cb45-5" tabindex="-1"></a>       <span class="at">CBI =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">89</span>)</span>
<span id="cb45-6"><a href="server.html#cb45-6" tabindex="-1"></a>     )</span>
<span id="cb45-7"><a href="server.html#cb45-7" tabindex="-1"></a></span>
<span id="cb45-8"><a href="server.html#cb45-8" tabindex="-1"></a>     <span class="co"># Creating a ggplot2 plot and converting it to Plotly</span></span>
<span id="cb45-9"><a href="server.html#cb45-9" tabindex="-1"></a>     <span class="fu">ggplotly</span>(</span>
<span id="cb45-10"><a href="server.html#cb45-10" tabindex="-1"></a>       <span class="fu">ggplot</span>(example_df, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> CBI)) <span class="sc">+</span></span>
<span id="cb45-11"><a href="server.html#cb45-11" tabindex="-1"></a>         <span class="fu">geom_point</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;#068D9D&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb45-12"><a href="server.html#cb45-12" tabindex="-1"></a>         <span class="fu">labs</span>(</span>
<span id="cb45-13"><a href="server.html#cb45-13" tabindex="-1"></a>           <span class="at">x =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">Year&quot;</span>,</span>
<span id="cb45-14"><a href="server.html#cb45-14" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">&quot;CBI</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb45-15"><a href="server.html#cb45-15" tabindex="-1"></a>         ) <span class="sc">+</span></span>
<span id="cb45-16"><a href="server.html#cb45-16" tabindex="-1"></a>         <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb45-17"><a href="server.html#cb45-17" tabindex="-1"></a>         <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>)),</span>
<span id="cb45-18"><a href="server.html#cb45-18" tabindex="-1"></a>       <span class="at">tooltip =</span> <span class="fu">c</span>(<span class="st">&quot;y&quot;</span>)</span>
<span id="cb45-19"><a href="server.html#cb45-19" tabindex="-1"></a>     )</span>
<span id="cb45-20"><a href="server.html#cb45-20" tabindex="-1"></a>   })</span></code></pre></div>
<p>This plot serves as an example for the Change Biodiversity Index, providing a visual representation of the CBI values across different years.</p>
</div>
<div id="tab-taxa-explorer" class="section level2 hasAnchor" number="5.5">
<h2><span class="header-section-number">5.5</span> Tab Taxa Explorer<a href="server.html#tab-taxa-explorer" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Using the reactive dataframe <code>survey_data</code>, we make a new reactive dataframe that is filtered for the selected taxa and selects certain columns:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="server.html#cb46-1" tabindex="-1"></a>  <span class="co"># Create a reactive dataframe &#39;df&#39; based on the selected taxa from the input.</span></span>
<span id="cb46-2"><a href="server.html#cb46-2" tabindex="-1"></a>  <span class="co"># This dataframe filters the &#39;survey_data()&#39; by the selected taxa and selects specific columns.</span></span>
<span id="cb46-3"><a href="server.html#cb46-3" tabindex="-1"></a>  taxa_df <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb46-4"><a href="server.html#cb46-4" tabindex="-1"></a>    <span class="fu">survey_data</span>() <span class="sc">%&gt;%</span></span>
<span id="cb46-5"><a href="server.html#cb46-5" tabindex="-1"></a>      <span class="fu">filter</span>(Taxa <span class="sc">==</span> input<span class="sc">$</span>taxa_select) <span class="sc">%&gt;%</span></span>
<span id="cb46-6"><a href="server.html#cb46-6" tabindex="-1"></a>      <span class="fu">select</span>(Species, Count, Observer, Date, PhotoID, geometry)</span>
<span id="cb46-7"><a href="server.html#cb46-7" tabindex="-1"></a>  })</span></code></pre></div>
<p>The new reactive daaframe <code>taxa_df</code> is then used throughout the server code for this tab.</p>
<p>This R Shiny server code is associated with the âTaxa Explorerâ tab (TAB 2) in a Shiny application. The purpose of this tab is to explore details related to a specific taxonomic group (Taxa). Letâs break down the code:</p>
<p><strong>Pie Chart (Species Distribution):</strong></p>
<ul>
<li><code>output$species_pie</code>: Renders a pie chart showing the distribution of species for the selected taxa. The chart displays the top 10 species based on their count.</li>
</ul>
<p><strong>Value Boxes:</strong></p>
<ul>
<li><p><code>output$num_species_taxa</code>: Renders a value box showing the number of distinct species for the selected taxa. The icon changes based on the selected taxa.</p>
<ul>
<li>A mapping between taxa names and icons is created.</li>
<li>When a taxa is selected in the Shiny application, it looks up the corresponding icon for that taxa from the icon_map.</li>
<li>If there is no specific icon for the selected taxa, it defaults to using the âleafâ icon.</li>
</ul></li>
<li><p><code>output$num_records_taxa</code>: Renders a value box showing the total number of records for the selected taxa.</p></li>
<li><p><code>output$top_obs</code>: Renders a value box highlighting the top observer based on the number of records for the selected taxa.</p></li>
</ul>
<p><strong>Bar Graph of Species Records:</strong></p>
<ul>
<li><code>output$species_bar</code>: Renders a bar graph showing the number of records for the top 50 species based on the count.</li>
</ul>
<p><strong>Data Tables:</strong></p>
<ul>
<li><p><code>output$taxa_table</code>: Renders a data table displaying all records for the selected taxa.</p></li>
<li><p><code>output$species_list</code>: Renders a data table listing species and their respective number of records, sorted in descending order.</p></li>
<li><p>The datatables use the <code>table_options</code> defined in global.R.</p></li>
</ul>
<p><strong>Leaflet Map:</strong></p>
<ul>
<li><code>output$MapPlot1</code>: Renders a Leaflet map displaying the locations of species occurrences for the selected taxa.</li>
</ul>
<p><strong>Modal for Record Photo:</strong></p>
<ul>
<li>Dynamically generates a modal UI for displaying the photo of a selected record when a row is selected in the data table. The modal includes an image and a close button. This could have been done with in built functions: <a href="https://shiny.posit.co/r/reference/shiny/1.7.3/modaldialog" class="uri">https://shiny.posit.co/r/reference/shiny/1.7.3/modaldialog</a> but I wanted more control over the functionality and the way images were displaying. The code runs JavaScript code using the <code>shinyjs</code> package. I used ChatGPT to help with code! The same logic is used for displaying a modal in the Student Engagement tab.</li>
</ul>
<ol style="list-style-type: decimal">
<li><strong><code>observeEvent(input$taxa_table_rows_selected, {...})</code>:</strong>
<ul>
<li>This observer is triggered when the user selects a row in the data table with the id <code>taxa_table</code>.</li>
<li><code>input$taxa_table_rows_selected</code> contains the indices of the selected rows.</li>
<li>The observer extracts the <code>PhotoID</code> associated with the selected row from the <code>taxa_df()</code> (assuming there is a reactive dataframe named <code>taxa_df()</code>).</li>
<li>If a valid <code>PhotoID</code> is found, it enables the modal, shows it, and sets the source (<code>src</code>) attribute of the image (<code>modalImage_taxa</code>) to the selected photo.</li>
</ul></li>
<li><strong><code>output$Modal_taxa &lt;- renderUI({...})</code>:</strong>
<ul>
<li>This is a dynamic UI element for rendering the modal. It is a Fluid Page containing a div with the id <code>customModal</code> and additional styling.</li>
<li>Inside the modal, there is another div (<code>modalContent</code>) that contains an <code>h4</code> element with the title âRecord Photo,â an image (<code>modalImage_taxa</code>), and a close button (<code>closeModalBtn_taxa</code>).</li>
<li>The <code>modalImage_taxa</code> has a dynamic source (<code>src</code>) that will be set by the JavaScript code when a row is selected.</li>
</ul></li>
<li><strong><code>observeEvent(input$closeModalBtn_taxa, {...})</code>:</strong>
<ul>
<li>This observer is triggered when the user clicks the âClose Modalâ button.</li>
<li>It runs JavaScript code to hide the modal (<code>$("#customModal").hide();</code>).</li>
</ul></li>
</ol>
<p>In summary, when a user selects a row in the data table, the associated photo is displayed in a modal. The modal is dynamically generated with the <code>renderUI</code> function, and it includes an image and a button to close the modal. The JavaScript code (<code>shinyjs::runjs</code>) is used to control the display and hiding of the modal.</p>
</div>
<div id="tab-student-engagement" class="section level2 hasAnchor" number="5.6">
<h2><span class="header-section-number">5.6</span> Tab Student Engagement<a href="server.html#tab-student-engagement" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Youâll find a lot of similar code here, icnluding datatables, valueboxes, plotly plot and the custom modal. The first few lines of code are new though:</p>
<p><strong>1. Student Heading</strong></p>
<p>First, the student heading is created and dynamically changes based on which student is selected using <code>input$student_select</code>.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="server.html#cb47-1" tabindex="-1"></a>  <span class="co"># Heading for the student engagement section</span></span>
<span id="cb47-2"><a href="server.html#cb47-2" tabindex="-1"></a>  <span class="co"># This will dynamically display the name of the selected student followed by &quot;Biodiversity Data&quot;</span></span>
<span id="cb47-3"><a href="server.html#cb47-3" tabindex="-1"></a>  output<span class="sc">$</span>student_heading <span class="ot">&lt;-</span> <span class="fu">renderText</span>({</span>
<span id="cb47-4"><a href="server.html#cb47-4" tabindex="-1"></a>    <span class="fu">paste</span>(input<span class="sc">$</span>student_select, <span class="st">&quot;&#39;s Biodiversity Data&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb47-5"><a href="server.html#cb47-5" tabindex="-1"></a>  })</span></code></pre></div>
<p><strong>2. About me section</strong></p>
<p>Then the âabout_meâ descriptions that the student wrote is pasted. If no paragraph is found, nothing (<code>""</code>) is displayed.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="server.html#cb48-1" tabindex="-1"></a><span class="co"># Description for the student engagement section</span></span>
<span id="cb48-2"><a href="server.html#cb48-2" tabindex="-1"></a><span class="co"># This fetches a description paragraph related to the selected student from the &#39;student_text_sep&#39; dataset</span></span>
<span id="cb48-3"><a href="server.html#cb48-3" tabindex="-1"></a>output<span class="sc">$</span>student_description <span class="ot">&lt;-</span> <span class="fu">renderText</span>({</span>
<span id="cb48-4"><a href="server.html#cb48-4" tabindex="-1"></a>  <span class="co"># Get the selected student from the input</span></span>
<span id="cb48-5"><a href="server.html#cb48-5" tabindex="-1"></a>  search_word <span class="ot">&lt;-</span> input<span class="sc">$</span>student_select</span>
<span id="cb48-6"><a href="server.html#cb48-6" tabindex="-1"></a>  </span>
<span id="cb48-7"><a href="server.html#cb48-7" tabindex="-1"></a>  <span class="co"># Find the index of the first occurrence of the selected student&#39;s name in student_text_sep</span></span>
<span id="cb48-8"><a href="server.html#cb48-8" tabindex="-1"></a>  search_paragraph <span class="ot">&lt;-</span> <span class="fu">grep</span>(search_word, student_text_sep)[<span class="dv">1</span>]</span>
<span id="cb48-9"><a href="server.html#cb48-9" tabindex="-1"></a>  </span>
<span id="cb48-10"><a href="server.html#cb48-10" tabindex="-1"></a>  <span class="co"># Extract the relevant paragraph based on the found index</span></span>
<span id="cb48-11"><a href="server.html#cb48-11" tabindex="-1"></a>  description <span class="ot">&lt;-</span> student_text_sep[search_paragraph]</span>
<span id="cb48-12"><a href="server.html#cb48-12" tabindex="-1"></a>  </span>
<span id="cb48-13"><a href="server.html#cb48-13" tabindex="-1"></a>  <span class="co"># If the student has not given a description, return a blank string</span></span>
<span id="cb48-14"><a href="server.html#cb48-14" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(description)) {</span>
<span id="cb48-15"><a href="server.html#cb48-15" tabindex="-1"></a>    description <span class="ot">&lt;-</span> <span class="st">&quot;&quot;</span></span>
<span id="cb48-16"><a href="server.html#cb48-16" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb48-17"><a href="server.html#cb48-17" tabindex="-1"></a>    description</span>
<span id="cb48-18"><a href="server.html#cb48-18" tabindex="-1"></a>  }</span>
<span id="cb48-19"><a href="server.html#cb48-19" tabindex="-1"></a>})</span></code></pre></div>
<ul>
<li><p><code>output$student_description &lt;- renderText({ ... })</code>: This sets up a reactive output element called <code>student_description</code>. The content of this output is generated dynamically based on the selected studentâs name.</p></li>
<li><p><code>search_word &lt;- input$student_select</code>: It gets the selected studentâs name from the <code>student_select</code> input.</p></li>
<li><p><code>search_paragraph &lt;- grep(search_word, student_text_sep)[1]</code>: This finds the index of the first occurrence of the selected studentâs name in the <code>student_text_sep</code> dataset. The <code>grep</code> function is used for pattern matching, and <code>[1]</code> is used to get the first match.</p></li>
<li><p><code>description &lt;- student_text_sep[search_paragraph]</code>: This extracts the relevant paragraph from the <code>student_text_sep</code> dataset based on the found index.</p></li>
<li><p><code>if (is.na(description)) { description &lt;- "" } else { description }</code>: This checks if the student has given a description. If the description is missing (<code>NA</code>), it sets <code>description</code> to an empty string. Otherwise, it leaves <code>description</code> unchanged.</p></li>
<li><p>The final <code>description</code> variable is then returned, and it will be displayed in the UI as the text content for the student engagement section. If the student has not provided a description, an empty string will be displayed.</p></li>
</ul>
<p><strong>3. Student Photo</strong></p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="server.html#cb49-1" tabindex="-1"></a><span class="co"># Display photo of the selected student</span></span>
<span id="cb49-2"><a href="server.html#cb49-2" tabindex="-1"></a><span class="co"># This dynamically fetches the photo based on the selected student&#39;s name</span></span>
<span id="cb49-3"><a href="server.html#cb49-3" tabindex="-1"></a>output<span class="sc">$</span>photoOutput <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb49-4"><a href="server.html#cb49-4" tabindex="-1"></a>  name <span class="ot">&lt;-</span> input<span class="sc">$</span>student_select</span>
<span id="cb49-5"><a href="server.html#cb49-5" tabindex="-1"></a>  </span>
<span id="cb49-6"><a href="server.html#cb49-6" tabindex="-1"></a>  <span class="co"># Check if a photo file exists for the selected student</span></span>
<span id="cb49-7"><a href="server.html#cb49-7" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">file.exists</span>(<span class="fu">paste0</span>(<span class="st">&quot;www/Team_Data/&quot;</span>, name, <span class="st">&quot;.jpg&quot;</span>))) {</span>
<span id="cb49-8"><a href="server.html#cb49-8" tabindex="-1"></a>    <span class="co"># If a photo exists, create an HTML div with an img tag</span></span>
<span id="cb49-9"><a href="server.html#cb49-9" tabindex="-1"></a>    photo <span class="ot">&lt;-</span> tags<span class="sc">$</span><span class="fu">div</span>(</span>
<span id="cb49-10"><a href="server.html#cb49-10" tabindex="-1"></a>      tags<span class="sc">$</span><span class="fu">img</span>(<span class="at">src =</span> <span class="fu">paste0</span>(<span class="st">&quot;Team_Data/&quot;</span>, name, <span class="st">&quot;.jpg&quot;</span>), <span class="at">height =</span> <span class="st">&quot;100px&quot;</span>, <span class="at">style =</span> <span class="st">&quot;margin-right: 10px; border-radius: 30px;&quot;</span>)</span>
<span id="cb49-11"><a href="server.html#cb49-11" tabindex="-1"></a>    )</span>
<span id="cb49-12"><a href="server.html#cb49-12" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb49-13"><a href="server.html#cb49-13" tabindex="-1"></a>    <span class="co"># If no photo exists, create an HTML div with a user-secret icon</span></span>
<span id="cb49-14"><a href="server.html#cb49-14" tabindex="-1"></a>    photo <span class="ot">&lt;-</span> tags<span class="sc">$</span><span class="fu">div</span>(</span>
<span id="cb49-15"><a href="server.html#cb49-15" tabindex="-1"></a>      <span class="fu">icon</span>(<span class="st">&quot;user-secret&quot;</span>, <span class="at">style =</span> <span class="st">&quot;margin-right: 10px; font-size: 50px&quot;</span>)</span>
<span id="cb49-16"><a href="server.html#cb49-16" tabindex="-1"></a>    )</span>
<span id="cb49-17"><a href="server.html#cb49-17" tabindex="-1"></a>  }</span>
<span id="cb49-18"><a href="server.html#cb49-18" tabindex="-1"></a>  </span>
<span id="cb49-19"><a href="server.html#cb49-19" tabindex="-1"></a>  <span class="co"># Return the created HTML div</span></span>
<span id="cb49-20"><a href="server.html#cb49-20" tabindex="-1"></a>  photo</span>
<span id="cb49-21"><a href="server.html#cb49-21" tabindex="-1"></a>})</span></code></pre></div>
<ul>
<li><p><code>output$photoOutput &lt;- renderUI({ ... })</code>: This sets up a reactive UI element called <code>photoOutput</code>. The content of this UI element is generated dynamically based on the selected studentâs name.</p></li>
<li><p><code>name &lt;- input$student_select</code>: It gets the selected studentâs name from the <code>student_select</code> input.</p></li>
<li><p><code>file.exists(paste0("www/Team_Data/", name, ".jpg"))</code>: This checks if a photo file exists for the selected student. It constructs the file path based on the name and checks if the file exists.</p></li>
<li><p>If a photo exists (<code>if</code> branch):</p>
<ul>
<li><code>photo &lt;- tags$div(...)</code> creates an HTML div element.</li>
<li><code>tags$img(...)</code> creates an img tag within the div, setting its source (<code>src</code> attribute) to the path of the photo file.</li>
<li>Additional styling is applied with <code>height</code>, <code>style</code> attributes.</li>
</ul></li>
<li><p>If no photo exists (<code>else</code> branch):</p>
<ul>
<li><code>photo &lt;- tags$div(...)</code> creates an HTML div element.</li>
<li><code>icon("user-secret", style = "margin-right: 10px; font-size: 50px")</code> creates an icon with a user-secret icon from the <code>shiny</code> package, providing additional styling.</li>
</ul></li>
<li><p><code>photo</code>: The final variable <code>photo</code> contains the dynamically generated HTML content (either an image or an icon).</p></li>
<li><p>The entire <code>photo</code> variable is then returned, and this UI element will display either the photo of the selected student or a user-secret icon if no photo is found.</p></li>
</ul>
</div>
<div id="tab-record-finder" class="section level2 hasAnchor" number="5.7">
<h2><span class="header-section-number">5.7</span> Tab Record Finder<a href="server.html#tab-record-finder" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="server.html#cb50-1" tabindex="-1"></a><span class="fu">observeEvent</span>(input<span class="sc">$</span>viewButton, {</span>
<span id="cb50-2"><a href="server.html#cb50-2" tabindex="-1"></a>  <span class="co"># Remove trailing space from PhotoID input</span></span>
<span id="cb50-3"><a href="server.html#cb50-3" tabindex="-1"></a>  cleaned_photo_id <span class="ot">&lt;-</span> <span class="fu">str_trim</span>(input<span class="sc">$</span>PhotoID, <span class="at">side =</span> <span class="st">&quot;right&quot;</span>)</span>
<span id="cb50-4"><a href="server.html#cb50-4" tabindex="-1"></a>  filename <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;www/&quot;</span>, cleaned_photo_id)</span>
<span id="cb50-5"><a href="server.html#cb50-5" tabindex="-1"></a></span>
<span id="cb50-6"><a href="server.html#cb50-6" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">file.exists</span>(filename)) {</span>
<span id="cb50-7"><a href="server.html#cb50-7" tabindex="-1"></a>    output<span class="sc">$</span>imageOutput <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb50-8"><a href="server.html#cb50-8" tabindex="-1"></a>      tags<span class="sc">$</span><span class="fu">div</span>(</span>
<span id="cb50-9"><a href="server.html#cb50-9" tabindex="-1"></a>        <span class="at">class =</span> <span class="st">&quot;record_image&quot;</span>,</span>
<span id="cb50-10"><a href="server.html#cb50-10" tabindex="-1"></a>        tags<span class="sc">$</span><span class="fu">img</span>(<span class="at">src =</span> <span class="fu">paste</span>(input<span class="sc">$</span>PhotoID), <span class="at">style =</span> <span class="st">&quot;display: block; max-width: 100%; max-height: 50vh&quot;</span>),</span>
<span id="cb50-11"><a href="server.html#cb50-11" tabindex="-1"></a>      )</span>
<span id="cb50-12"><a href="server.html#cb50-12" tabindex="-1"></a>    })</span>
<span id="cb50-13"><a href="server.html#cb50-13" tabindex="-1"></a>    <span class="fu">toggle</span>(<span class="st">&quot;imageOutput&quot;</span>)</span>
<span id="cb50-14"><a href="server.html#cb50-14" tabindex="-1"></a>  }</span>
<span id="cb50-15"><a href="server.html#cb50-15" tabindex="-1"></a>})</span></code></pre></div>
<ol style="list-style-type: decimal">
<li><strong><code>observeEvent(input$viewButton, {...})</code>:</strong>
<ul>
<li>This observer is triggered when the button with the id <code>viewButton</code> is clicked.</li>
</ul></li>
<li><strong>Image Loading Logic:</strong>
<ul>
<li><code>cleaned_photo_id &lt;- str_trim(input$PhotoID, side = "right")</code>: Removes trailing spaces from the input <code>PhotoID</code>.</li>
<li><code>filename &lt;- paste0("www/", cleaned_photo_id)</code>: Creates the file path for the image using the cleaned <code>PhotoID</code>.</li>
<li><code>if (file.exists(filename)) { ... }</code>: Checks if the file exists in the specified path.</li>
</ul></li>
<li><strong>UI Rendering:</strong>
<ul>
<li>If the file exists, it renders a dynamic UI (<code>output$imageOutput</code>) containing an image (<code>tags$img</code>) with the source set to the specified <code>PhotoID</code>. The image is styled to have a maximum width of 100% and a maximum height of 50vh (50% of the viewport height).</li>
<li><code>toggle("imageOutput")</code>: This is likely a custom function to toggle the visibility of the image.</li>
</ul></li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ui.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="next-steps.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
